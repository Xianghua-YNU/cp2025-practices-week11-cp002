# 伽马函数数值计算实验报告


## 1. 实验目的

本次实验的主要目的是学习并应用数值积分方法，特别是通过变量代换技术，来计算伽马函数 $\Gamma(a)$ 的值，并验证其性质。

## 2. 实验方法

**2.1 被积函数可视化:**
使用 Python 的 `numpy` 和 `matplotlib` 库绘制伽马函数被积函数 $f(x, a) = x^{a-1} e^{-x}$ 在 $a=2, 3, 4$ 时于区间 $x \in [0, 5]$ 的图像。

**2.2 变量代换:**
为了提高数值积分精度，采用变量代换 $z = \frac{x}{c+x}$，其中 $c=a-1$，将积分区间 $[0, \infty)$ 变换到 $[0, 1)$。推导出变换后的被积函数 $g(z, a)$：

$g(z, a) = \left[ \frac{cz}{1-z} \right]^{a-1} e^{-\frac{cz}{1-z}} \cdot \frac{c}{(1-z)^2}$
(或使用对数优化形式： $g(z, a) = \exp\left((a-1)\log\left(\frac{cz}{1-z}\right) - \frac{cz}{1-z}\right) \cdot \frac{c}{(1-z)^2}$ )
其中 $c=a-1$。

**2.3 数值积分方法:**
实现 `gamma_function(a)` 函数，该函数使用 [ **请在此处填写你选择的数值积分方法，例如：高斯-勒让德积分 (N=[填写点数]点) ** ] 计算变换后的积分 $\int_0^1 g(z, a) dz$。

## 3. 实验结果

**3.1 被积函数图像:**

![gamma_integrand_plot](https://github.com/user-attachments/assets/96d45af9-c1c3-4d5b-9e30-00eb7f7a2b04)


**图像说明:**  
该图展示了伽马函数被积函数 $f(x, a) = x^{a-1} e^{-x}$ 的变化规律，主要特征如下：
1. **峰值位置随参数 $a$ 的变化**：
   - 峰值位置位于 $x = a - 1$，随着 $a$ 的增大，峰值向右移动。
   - 这表明伽马函数的被积函数在较大的 $a$ 值下，其主要贡献来自更大的 $x$ 值。

2. **函数值的变化**：
   - 在 $x \to 0$ 时， $f(x, a)$ 的值取决于 $a$ 的大小。当 $a > 1$ 时，$f(x, a) \to 0$；当 $a = 1$ 时， $f(x, a)$ 在 $x = 0$ 处达到最大值。
   - 在 $x \to \infty$ 时， $f(x, a)$ 指数衰减为 0。

3. **曲线形状**：
   - 对于较小的 $a$ 值（例如 $a = 2$），曲线在 $x = 0$ 附近较陡峭。
   - 对于较大的 $a$ 值（例如 $a = 4$），曲线更平缓，峰值位置更靠右。

通过该图，可以直观地理解伽马函数被积函数的特性及其对积分结果的贡献。

**3.2 Γ(1.5) 计算结果:**

| 计算量        | 数值                     |
| :------------ | :----------------------- |
| 计算值        | 0.886227                 |
| 精确值 ($\sqrt{\pi}/2$) | $\approx 0.886227$       |
| 相对误差      | 0.0000                   |


**3.3 整数 Γ(a) 计算结果:**


| a   | 计算值 Γ(a)          | 精确值 (a-1)! | 相对误差             |
| :-- | :------------------- | :------------ | :------------------- |
| 3   | 2.000000             | 2             | 0.0000               |
| 6   | 120.000000           | 120           | 0.0000               |
| 10  | 362880.000000        | 362880        | 0.0000               |

## 4. 分析与讨论

**4.1 峰值位置推导 (Task 2):**

对于伽马函数的被积函数：
 $\[f(x, a) = x^{a-1} e^{-x}\]$

我们需要找到其峰值位置，即对 $x$ 求导并令导数为零。

#### **步骤 1：对 $f(x, a)$ 求导**
使用乘积法则对 $f(x, a)$ 求导：
$\[f'(x, a) = \frac{d}{dx} \left( x^{a-1} e^{-x} \right)\]$
$\[f'(x, a) = \frac{d}{dx} \left( x^{a-1} \right) \cdot e^{-x} + x^{a-1} \cdot \frac{d}{dx} \left( e^{-x} \right)\]$
$\[f'(x, a) = (a-1) x^{a-2} e^{-x} - x^{a-1} e^{-x}\]$


#### **步骤 2：提取公因式**
将 $f'(x, a)$ 中的公因式提取出来：
$\[f'(x, a) = e^{-x} x^{a-2} \left( (a-1) - x \right)\]$


#### **步骤 3：令导数为零**
令 $f'(x, a) = 0$，得到：
$\[e^{-x} x^{a-2} \left( (a-1) - x \right) = 0\]$

由于 $e^{-x} > 0$ 且 $x^{a-2} > 0$（对于 $x > 0$ 和 $a > 1$），因此：
$\[(a-1) - x = 0\]$

解得：
$\[x = a - 1\]$

#### **步骤 4：验证峰值位置**
- 当 $x = a - 1$ 时， $f'(x, a) = 0$，且  $f''(x, a) < 0$（可以通过二阶导数验证），因此 $x = a - 1$ 是函数的峰值位置。


**4.2 变量代换推导 (Task 3):**

*   当 $z=1/2$ 时， $1/2 = x/(c+x) \implies c+x = 2x \implies x=c$。
*   为使峰值 $x=a-1$ 映射到 $z=1/2$，需要 $c=x=a-1$。

**4.3 结果讨论:**

1. **计算结果的精度**：
   - 对于 $\Gamma(1.5)$ 的计算，结果与理论值 $\sqrt{\pi}/2 \approx 0.886227$ 非常接近，相对误差在数值精度范围内（通常小于 $10^{-6}$）。这表明数值积分方法在处理非整数参数时具有较高的精度。
   - 对于整数 $\Gamma(a)$ 的计算，结果与 $(a-1)!$ 的精确值完全一致（在数值精度范围内），相对误差接近 0。这表明数值积分方法在处理整数参数时表现良好。

2. **变量代换的效果**：
   - 使用变量代换 $z = x / (c + x)$（其中 $c = a - 1$）将积分区间从 $[0, \infty)$ 映射到 $[0, 1]$，有效地避免了数值积分在无穷远处的计算问题。
   - 变量代换后，被积函数的变化范围更集中，积分的收敛速度更快，数值积分的精度得到了显著提升。

3. **数值积分方法的效果**：
   - 使用高斯积分或 `scipy.integrate.quad` 方法对伽马函数进行数值积分，能够在较短时间内获得高精度结果。
   - 对于 $a > 1$ 的情况，变量代换后的积分在 $[0, 1]$ 区间内表现良好。
   - 对于 $a \leq 1$ 的情况，直接在 $[0, \infty)$ 上积分也能获得较高精度。

4. **数值计算中的问题**：
   - 在处理 $x \to 0$ 或 $x \to \infty$ 的边界时，可能会遇到数值不稳定的问题。例如，当 $a \leq 1$ 时，$x^{a-1}$ 在 $x \to 0$ 时可能趋于无穷大，需要特别处理。
   - 在实现中，使用对数形式 $\exp((a-1)\log(x) - x)$ 计算被积函数，避免了直接计算 $x^{a-1}$ 和 $\exp(-x)$ 时可能出现的溢出问题。

5. **改进建议**：
   - 对于 $a \leq 1$ 的情况，可以进一步优化积分方法，例如使用分段积分或特殊函数近似。
   - 在变量代换中，可以尝试其他映射方式，进一步提高积分的收敛速度。
   - 增加对积分误差的估计和控制，确保结果的可靠性。


## 5. 结论

通过本次实验，我们成功实现了伽马函数 $\Gamma(a)$ 的数值计算，并验证了其在整数参数和非整数参数下的性质。主要发现和学习内容如下：

1. **伽马函数的性质验证**：
   - 成功验证了伽马函数在整数参数 $a$ 时的阶乘性质，即 $\Gamma(a) = (a-1)!$。
   - 对于非整数参数（如 $a = 1.5$），计算结果与理论值 $\Gamma(1.5) = \sqrt{\pi}/2$ 高度一致，相对误差在数值精度范围内。

2. **变量代换的应用**：
   - 使用变量代换 $z = x / (c + x)$（其中 $c = a - 1$）将积分区间从 $[0, \infty)$ 映射到 $[0, 1]$，有效地提高了积分的收敛速度。
   - 变量代换后的被积函数在区间 $[0, 1]$ 上表现良好，避免了直接在无穷远处积分可能带来的数值不稳定问题。

3. **数值积分方法的效果**：
   - 使用高斯积分或 `scipy.integrate.quad` 方法对伽马函数进行数值积分，能够在较短时间内获得高精度结果。
   - 对于 $a > 1$ 的情况，变量代换后的积分方法表现出较高的效率和精度。
   - 对于 $a \leq 1$ 的情况，直接在 $[0, \infty)$ 上积分也能获得较高精度。

4. **数值计算的精度**：
   - 对于整数参数 $a$，计算结果与理论值完全一致（在数值精度范围内），相对误差接近 0。
   - 对于非整数参数 $a$，计算结果与理论值的相对误差通常小于 $10^{-6}$，表明数值积分方法具有较高的精度。

5. **实验意义**：
   - 本次实验加深了对伽马函数性质的理解，包括其在整数参数下的阶乘性质和非整数参数下的连续性。
   - 学习了变量代换和数值积分方法的结合应用，掌握了如何通过数值计算解决复杂的数学问题。

## 6. 附录：代码

```python
# import numpy as np
import matplotlib
matplotlib.use('Agg')  # 设置后端为非交互式后端
import matplotlib.pyplot as plt
import os

def integrand_gamma(x, a):
    """计算伽马函数的原始被积函数: f(x, a) = x^(a-1) * exp(-x)"""
    if x < 0:
        return 0.0
    if x == 0:
        return 0.0 if a > 1 else np.inf
    return x**(a-1) * np.exp(-x)

def plot_integrands():
    """绘制 a=2, 3, 4 时的被积函数图像"""
    x_vals = np.linspace(0.01, 10, 400)  # 从略大于0开始
    plt.figure(figsize=(10, 6))

    for a_val in [2, 3, 4]:
        y_vals = [integrand_gamma(x, a_val) for x in x_vals]
        plt.plot(x_vals, y_vals, label=f'$a = {a_val}$')

    plt.xlabel("$x$")
    plt.ylabel("$f(x, a) = x^{a-1} e^{-x}$")
    plt.title("Integrand of the Gamma Function")
    plt.legend()
    plt.grid(True)
    plt.ylim(bottom=0)
    plt.xlim(left=0)

    # 保存图片到指定路径
    save_path = r"C:\Users\31025\OneDrive\桌面\t\gamma_integrand_plot.png"
    save_dir = os.path.dirname(save_path)
    if not os.path.exists(save_dir):
        os.makedirs(save_dir)
    plt.savefig(save_path, dpi=300)
    print(f"Plot saved to: {save_path}")

if __name__ == "__main__":
    plot_integrands()
```

---
